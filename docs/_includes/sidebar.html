{% comment %}
    Create an empty array to store secondary nav sections
{% endcomment %}
{% assign secondary_sections = '' | split: ',' %}

{% for p in site.pages %}
    {% if p.section == page.section and p.secondary_section %}
        {% unless secondary_sections contains p.secondary_section %}
            {% assign secondary_sections = secondary_sections | push: p.secondary_section %}
        {% endunless %}
    {% endif %}
{% endfor %}

{% comment %}
    Alphabetize the sections
{% endcomment %}
{% assign secondary_sections = secondary_sections | sort %}

{% if secondary_sections %}
<ul>
    {% for secondary_section in secondary_sections | sort %}
    <li>
        {{ secondary_section }}
        <ul>
            {% for p in site.pages %}
                {% if p.section == page.section and p.secondary_section == secondary_section %}
                <li><a href="{{ site.baseurl }}/{{ p.section }}/{{ p.title | slugify }}">{{ p.title }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>
{% else %}
<ul>
    {% for p in site.pages %}
        {% if p.section == page.section %}
        <li><a href="{{ site.baseurl }}/{{ p.section }}/{{ p.title | slugify }}">{{ p.title }}</a></li>
        {% endif %}
    {% endfor %}
</ul>
{% endif %}
